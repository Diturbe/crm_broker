{% extends "base.html" %}

{% block title %}Siniestros · CRM Broker{% endblock %}

{% block base_extra_css %}
    .siniestros-layout {
        display:flex;
        gap:20px;
        flex-wrap:wrap;
    }

    .card {
        background:white;
        border-radius:10px;
        padding:18px;
        box-shadow:0 2px 6px rgba(0,0,0,0.07);
        margin-bottom:20px;
    }

    .card h3 {
        margin-top:0;
        margin-bottom:10px;
        font-size:16px;
        color:#05386B;
    }

    .form-grid {
        display:grid;
        grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
        gap:10px 18px;
    }

    label {
        font-size:12px;
        margin-bottom:3px;
        display:block;
        color:#495057;
    }
    input, select, textarea {
        width:100%;
        padding:6px 8px;
        border-radius:4px;
        border:1px solid #ced4da;
        font-size:13px;
        resize:vertical;
    }

    .btn {
        padding:7px 14px;
        border-radius:4px;
        border:none;
        font-size:13px;
        cursor:pointer;
    }
    .btn-primary { background:#05386B; color:#fff; }
    .btn-secondary { background:#6c757d; color:#fff; }
    .btn-xs { padding:4px 8px; font-size:11px; }

    table {
        width:100%;
        border-collapse:collapse;
        font-size:12px;
    }
    thead {
        background:#05386B;
        color:white;
    }
    th, td {
        padding:8px;
        border-bottom:1px solid #eee;
        text-align:left;
    }
    tr:nth-child(even) { background:#f9f9f9; }

    .badge {
        display:inline-block;
        padding:3px 8px;
        border-radius:999px;
        font-size:11px;
        font-weight:bold;
    }
    .badge.denunciado { background:#fff3cd; color:#856404; }
    .badge.gestion    { background:#cce5ff; color:#004085; }
    .badge.pagado     { background:#d4edda; color:#155724; }
    .badge.rechazado  { background:#f8d7da; color:#721c24; }
{% endblock %}

{% block content %}

<h1>Siniestros</h1>
<p class="subtitle">Registro básico de siniestros y seguimiento de estado.</p>

<div class="siniestros-layout">

    <div class="card" style="flex:1; min-width:280px;">
        <h3>Nuevo siniestro</h3>
        <form method="post" action="{{ url_for('crear_siniestro') }}">
            <div class="form-grid">
                <div>
                    <label>Fecha del siniestro</label>
                    <input type="date" name="fecha_siniestro">
                </div>
                <div>
                    <label>Tipo</label>
                    <input type="text" name="tipo" placeholder="Choque, robo, etc.">
                </div>
                <div>
                    <label>Estado</label>
                    <select name="estado">
                        <option value="DENUNCIADO">Denunciado</option>
                        <option value="EN GESTIÓN">En gestión</option>
                        <option value="PAGADO">Pagado</option>
                        <option value="RECHAZADO">Rechazado</option>
                    </select>
                </div>

                <div>
                    <label>Asegurado</label>
                    <input type="text" name="asegurado">
                </div>
                <div>
                    <label>DNI</label>
                    <input type="text" name="dni">
                </div>
                <div>
                    <label>Teléfono</label>
                    <input type="text" name="telefono">
                </div>
                <div>
                    <label>Email</label>
                    <input type="email" name="email">
                </div>

                <div>
                    <label>Compañía</label>
                    <input type="text" name="compania">
                </div>
                <div>
                    <label>N° póliza</label>
                    <input type="text" name="numero_poliza">
                </div>

                <div style="grid-column:1 / -1;">
                    <label>Descripción</label>
                    <textarea name="descripcion" rows="3"></textarea>
                </div>
            </div>

            <br>
            <button type="submit" class="btn btn-primary">Guardar siniestro</button>
        </form>
    </div>

    <div class="card" style="flex:2; min-width:380px;">
        <h3>Listado de siniestros</h3>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Fecha sins.</th>
                    <th>Fecha den.</th>
                    <th>Tipo</th>
                    <th>Asegurado</th>
                    <th>Compañía</th>
                    <th>N° póliza</th>
                    <th>Estado</th>
                    <th>Cambiar estado</th>
                </tr>
            </thead>
            <tbody>
            {% for s in siniestros %}
                {% set est = s.estado or '' %}
                <tr>
                    <td>{{ s.id }}</td>
                    <td>{{ s.fecha_siniestro.strftime('%d/%m/%Y') }}</td>
                    <td>{{ s.fecha_denuncia.strftime('%d/%m/%Y') }}</td>
                    <td>{{ s.tipo }}</td>
                    <td>{{ s.asegurado }}</td>
                    <td>{{ s.compania }}</td>
                    <td>{{ s.numero_poliza }}</td>
                    <td>
                        {% if est == 'DENUNCIADO' %}
                            <span class="badge denunciado">Denunciado</span>
                        {% elif est == 'EN GESTIÓN' %}
                            <span class="badge gestion">En gestión</span>
                        {% elif est == 'PAGADO' %}
                            <span class="badge pagado">Pagado</span>
                        {% elif est == 'RECHAZADO' %}
                            <span class="badge rechazado">Rechazado</span>
                        {% else %}
                            <span class="badge">{{ s.estado }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <form method="post" action="{{ url_for('cambiar_estado_siniestro', id=s.id) }}">
                            <select name="estado">
                                <option value="DENUNCIADO" {% if s.estado == 'DENUNCIADO' %}selected{% endif %}>Denunciado</option>
                                <option value="EN GESTIÓN" {% if s.estado == 'EN GESTIÓN' %}selected{% endif %}>En gestión</option>
                                <option value="PAGADO" {% if s.estado == 'PAGADO' %}selected{% endif %}>Pagado</option>
                                <option value="RECHAZADO" {% if s.estado == 'RECHAZADO' %}selected{% endif %}>Rechazado</option>
                            </select>
                            <button class="btn btn-xs btn-secondary">Actualizar</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

</div>

{% endblock %}