{% extends "base.html" %}

{% block title %}Dashboard · CRM Broker{% endblock %}

{% block base_extra_css %}
    .dashboard-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
    }

    .cards-row {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .card {
        flex: 1;
        min-width: 180px;
        padding: 18px;
        border-radius: 10px;
        color: white;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .total   { background: #0c3c78; }
    .vigente { background: #28a745; }
    .porvencer { background: #ffc107; color: #212529; }
    .vencida { background: #dc3545; }

    .card h2 {
        margin: 0;
        font-size: 16px;
    }
    .card p {
        margin: 8px 0 0;
        font-size: 22px;
        font-weight: bold;
    }

    .chart-card, .box {
        background: white;
        border-radius: 10px;
        padding: 18px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.07);
        margin-bottom: 20px;
    }

    .small {
        font-size: 12px;
        color: #555;
    }
{% endblock %}

{% block extra_head %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var canvas = document.getElementById('polizasChart');
            if (!canvas) return;

            var ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Vigentes', 'Por vencer', 'Vencidas'],
                    datasets: [{
                        data: [{{ vigentes }}, {{ por_vencer }}, {{ vencidas }}],
                        backgroundColor: ['#28a745','#ffc107','#dc3545']
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
    </script>
{% endblock %}

{% block content %}

    <h1>Dashboard</h1>
    <p class="subtitle">Resumen rápido de producción, renovaciones y finanzas.</p>

    <div class="cards-row">
        <div class="card total">
            <h2>Total pólizas</h2>
            <p>{{ total }}</p>
        </div>
        <div class="card vigente">
            <h2>Vigentes</h2>
            <p>{{ vigentes }}</p>
        </div>
        <div class="card porvencer">
            <h2>Por vencer (≤ 30 días)</h2>
            <p>{{ por_vencer }}</p>
        </div>
        <div class="card vencida">
            <h2>Vencidas</h2>
            <p>{{ vencidas }}</p>
        </div>
    </div>

    <div class="cards-row">
        <div class="card total">
            <h2>Total comisiones estimadas</h2>
            <p>$ {{ '%.2f'|format(total_comisiones) }}</p>
        </div>
        <div class="card vigente">
            <h2>Ingresos</h2>
            <p>$ {{ '%.2f'|format(total_ingresos) }}</p>
        </div>
        <div class="card vencida">
            <h2>Egresos</h2>
            <p>$ {{ '%.2f'|format(total_egresos) }}</p>
        </div>
        <div class="card porvencer">
            <h2>Saldo neto</h2>
            <p>$ {{ '%.2f'|format(saldo) }}</p>
        </div>
    </div>

    <div class="dashboard-grid">
        <div>
            <div class="chart-card">
                <h3>Distribución de pólizas</h3>
                <canvas id="polizasChart"></canvas>
            </div>
        </div>

        <div>
            <div class="box">
                <h2>Notas rápidas</h2>
                <p class="small">
                    Usá este panel como recordatorio:
                </p>
                <ul class="small">
                    <li>Revisar pólizas por vencer para no perder renovaciones.</li>
                    <li>Controlar comisiones acreditadas vs. producción real.</li>
                    <li>Ver que el saldo neto cubra los gastos fijos del estudio.</li>
                </ul>
            </div>
        </div>
    </div>

{% endblock %}